<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=yes"><title>梨视频初级爬取 | Sweet House</title><meta name=description content="Everyday is a holiday"><meta name=bytedance-verification-code content="MmXZwSvr8lAvM1hIXSkm"><meta name=author content="[Ryuchen WangOO]"><link rel=icon href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism-dark.min.css><link rel=stylesheet href=/dist/main.4707e15c5ca4eab5da71.min.css><link rel=stylesheet href=/css/shortcodes.css><link rel=canonical href=https://ryuchen.club/posts/0x000012/><meta property="og:title" content="梨视频初级爬取"><meta property="og:description" content="这是一个系列内容，最近女友在跟我学习Python编程，然后就开了这个爬虫系列，主要也是借此机会将自己所会的爬虫相关的知识进行梳理并同时做好备课工作~~【如果这个系列对你有帮助的话，请在这个博客下面留言，我会尽可能做好思路梳理】"><meta property="og:type" content="article"><meta property="og:url" content="https://ryuchen.club/posts/0x000012/"><meta property="og:image" content="https://ryuchen.club/spider-requests.jpg"><meta property="article:published_time" content="2020-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-31T00:00:00+00:00"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000015/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000014/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000013/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000011/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000010/"><meta itemprop=name content="梨视频初级爬取"><meta itemprop=description content="这是一个系列内容，最近女友在跟我学习Python编程，然后就开了这个爬虫系列，主要也是借此机会将自己所会的爬虫相关的知识进行梳理并同时做好备课工作~~【如果这个系列对你有帮助的话，请在这个博客下面留言，我会尽可能做好思路梳理】"><meta itemprop=datePublished content="2020-03-31T00:00:00+00:00"><meta itemprop=dateModified content="2020-03-31T00:00:00+00:00"><meta itemprop=wordCount content="545"><meta itemprop=image content="https://ryuchen.club/spider-requests.jpg"><meta itemprop=keywords content="spider,requests,爬虫,"></head><body><nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id=navbar-main-menu><div class=container><a class="navbar-brand font-weight-bold" href=https://ryuchen.club>>$ cd /home_</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#main-menu aria-controls=main-menu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=main-menu><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>首页</a></li><li class=nav-item><a class=nav-link href=/posts/>博文</a></li><li class=nav-item><a class=nav-link href=/projects/>项目</a></li><li class=nav-item><a class=nav-link href=/snippet/>代码</a></li><li class=nav-item><a class=nav-link href=/essay/>随笔</a></li><li class=nav-item><a class=nav-link href=/gallery/>照片墙</a></li><li class=nav-item><a class=nav-link href=/about/>关于</a></li><li class=nav-item><a class=nav-link href=https://github.com/Ryuchen target=_blank>Github</a></li></ul></div></div></nav><main class="content-page container pt-7 pb-5"><div class=row><div class=col><article><div class="row justify-content-center"><div class=col-lg-10><h1>梨视频初级爬取</h1><div class="meta text-muted mb-3" style=text-align:right><p class="created text-muted text-uppercase font-weight-bold mb-1">March 31, 2020</p><span class=mr-2><i class="fas fa-book-open mr-2"></i>1554</span>
<span><i class="fas fa-clock mr-2"></i>7 minutes and
3 seconds</span></div><div class="category my-3"><a class="badge badge-pill badge-light border mr-2" href=/categories/%E7%88%AC%E8%99%AB%E7%B3%BB%E5%88%97><i class="fas fa-tag mr-2"></i>爬虫系列</a></div></div></div><div class="row justify-content-center mb-3"><div class=col-lg-10><img data-src=/images/spider-requests_huc4b4663bc63a0e31a40f04bc97652a90_494620_900x500_fit_q75_box.jpg class="img-fluid rounded mx-auto d-block" alt=梨视频初级爬取></div></div><div class="row justify-content-center"><div class=col-lg-10><div class=content><blockquote><p>[DeadPool爬虫]梨视频初级爬取</p></blockquote><p>通过上面一个爬虫教程，我们已经简单的介绍了一下requests库的使用，那么如何结合到实际爬虫使用中呢？这期的小课糖，就是结合requests的库使用，来进行一个小型爬虫实例的编写，后续我们将慢慢扩充这个小的项目，并直至将这个项目结合我的Deadpool框架使用起来~</p><blockquote><p>PS: 如果您已经有爬虫相关知识了，可以直接看我的框架地址<a href=https://github.com/Ryuchen/Deadpool>Deadpool项目</a></p></blockquote><h5 id=实战爬取梨视频网站>实战爬取梨视频网站</h5><p>话不多说，直接上最终代码效果~</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=ch>#!/usr/bin/env python</span>
<span class=c1># -*- code: utf-8 -*-</span>

<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>re</span>
<span class=kn>import</span> <span class=nn>urllib</span>
<span class=kn>import</span> <span class=nn>requests</span>


<span class=k>def</span> <span class=nf>download_pearvideo</span><span class=p>():</span>
    <span class=n>storage</span> <span class=o>=</span> <span class=s1>&#39;video&#39;</span>
    <span class=k>if</span> <span class=n>storage</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>():</span>
        <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>storage</span><span class=p>)</span>

    <span class=n>seed_url</span> <span class=o>=</span> <span class=s2>&#34;https://www.pearvideo.com/category_8&#34;</span>

    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;user-agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36 Edg/80.0.361.69&#39;</span>
    <span class=p>}</span>

    <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
    <span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;vervideo-lilink actplay&#34;&gt;&#39;</span>
    <span class=n>vids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
    <span class=n>videos</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>prefix_url</span> <span class=o>=</span> <span class=s2>&#34;https://www.pearvideo.com/&#34;</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>vids</span><span class=p>:</span>
        <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>_</span>
        <span class=n>videos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>videos</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=n>_</span><span class=p>)</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;ldUrl=&#34;&#34;,srcUrl=&#34;(.*?)&#34;,vdoUrl=&#39;</span>
        <span class=n>video_url</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;h1 class=&#34;video-tt&#34;&gt;(.*?)&lt;/h1&gt;&#39;</span>
        <span class=n>video_name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=k>print</span><span class=p>(</span><span class=n>f</span><span class=s1>&#39;正在下载视频: {video_name[0]}&#39;</span><span class=p>)</span>
        <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>video_url</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>storage</span><span class=p>,</span> <span class=n>f</span><span class=s2>&#34;{video_name[0]}.mp4&#34;</span><span class=p>))</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
    <span class=n>download_pearvideo</span><span class=p>()</span>
</code></pre></div><p>对整体代码有个直观的感受之后，我们来对代码结合第一次的课程进行一个详细的讲解</p><p>===</p><p>这段代码是创建存储路径，很简单，判断一下是否路径已经存在，不存在则创建</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>	<span class=n>storage</span> <span class=o>=</span> <span class=s1>&#39;video&#39;</span>
	<span class=k>if</span> <span class=n>storage</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>():</span>
	    <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>storage</span><span class=p>)</span>
</code></pre></div><p>===</p><p>这段代码是构建我们请求的headers，即上个博客内容中的requests headers部分</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;user-agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36 Edg/80.0.361.69&#39;</span>
    <span class=p>}</span>
</code></pre></div><p>===</p><p>这段代码是请求页面内容，这里返回的正式几个常见的类型之一，html body</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</code></pre></div><p>===</p><p>这段代码是将下载的页面内容通过正则的手段匹配我们想要的内容，并形成下一步请求的链接列表</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;vervideo-lilink actplay&#34;&gt;&#39;</span>
<span class=n>vids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
<span class=n>videos</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>prefix_url</span> <span class=o>=</span> <span class=s2>&#34;https://www.pearvideo.com/&#34;</span>
<span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>vids</span><span class=p>:</span>
    <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>_</span>
    <span class=n>videos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>
</code></pre></div><p>===</p><p>这段代码是通过循环的方式将我们目标挨个请求一遍</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>videos</span><span class=p>:</span>
    <span class=k>print</span><span class=p>(</span><span class=n>_</span><span class=p>)</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</code></pre></div><p>===</p><p>这段代码也是将下载的页面内容通过正则的手段匹配我们想要的内容(视频连接、视频名称)</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;ldUrl=&#34;&#34;,srcUrl=&#34;(.*?)&#34;,vdoUrl=&#39;</span>
<span class=n>video_url</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
<span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;h1 class=&#34;video-tt&#34;&gt;(.*?)&lt;/h1&gt;&#39;</span>
<span class=n>video_name</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</code></pre></div><p>===</p><p>这段代码将我们的视频下载下来，并进行保存</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=k>print</span><span class=p>(</span><span class=n>f</span><span class=s1>&#39;正在下载视频: {video_name[0]}&#39;</span><span class=p>)</span>
<span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>video_url</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>storage</span><span class=p>,</span> <span class=n>f</span><span class=s2>&#34;{video_name[0]}.mp4&#34;</span><span class=p>))</span>
</code></pre></div><p>OK，代码讲解完毕，是不是十分简单~</p><h5 id=实战练习>实战练习</h5><p>上面的简单例子做好代码解读之后，我们这次也再结合一个实战的例子巩固一下，下面就是结合上面所说的实战练习</p><p>目标是：
通过请求梨视频网站的科技类栏目，然后找到页面内短视频的创作者，进入创作者的页面，获取其创作的短视频进行保存，这里保存的方式是以md5命名视频文件MD5.mp4，并创建一个与之相对应的MD5.txt文件记录视频的标题和描述</p><blockquote><p>代码链接来自我<a href=https://github.com/huandoit/pyStudy/blob/master/daily/2020-03-31.py>女朋友的Github-2020-03-31</a></p></blockquote><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=ch>#!/usr/bin/env python</span>
<span class=c1># -*- coding: utf-8 -*-</span>
<span class=s2>&#34;&#34;&#34;
</span><span class=s2>@Time    : 2020/4/1 9:48
</span><span class=s2>@Author  : WangHuan
</span><span class=s2>@Contact : hi_chengzi@126.com
</span><span class=s2>@File    : 2020-03-31.py
</span><span class=s2>@Software: PyCharm
</span><span class=s2>@description: 爬虫实例操作，下载梨视频中的所有视频
</span><span class=s2>&#34;&#34;&#34;</span>
<span class=kn>import</span> <span class=nn>hashlib</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>re</span>
<span class=kn>import</span> <span class=nn>urllib.request</span>
<span class=kn>import</span> <span class=nn>requests</span>

<span class=c1># 查看是否存在videos目录，如果没有则创建</span>
<span class=n>storage</span> <span class=o>=</span> <span class=s1>&#39;videos&#39;</span>
<span class=k>if</span> <span class=n>storage</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>():</span>
    <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>storage</span><span class=p>)</span>

<span class=n>seed_url</span> <span class=o>=</span> <span class=s1>&#39;https://www.pearvideo.com/category_8&#39;</span>
<span class=n>prefix_url</span> <span class=o>=</span> <span class=s1>&#39;https://www.pearvideo.com/&#39;</span>

<span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&#39;</span>
<span class=p>}</span>


<span class=c1># 下载科技页面的视频</span>
<span class=k>def</span> <span class=nf>download_pearvideo</span><span class=p>():</span>
    <span class=c1># 找到页面中的视频地址并保存</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
    <span class=n>vids_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;vervideo-lilink actplay&#34;&gt;&#39;</span>
    <span class=n>vids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>vids_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
    <span class=n>videos</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>vids</span><span class=p>:</span>
        <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>_</span>
        <span class=n>videos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>

    <span class=c1># 访问视频地址，将视频保存为以标题命名的视频文件</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>videos</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=n>_</span><span class=p>)</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>mp4_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;ldUrl=&#34;&#34;,srcUrl=&#34;(.*?)&#34;,vdoUrl=&#39;</span>
        <span class=n>video_url</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>mp4_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=n>title_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;h1 class=&#34;video-tt&#34;&gt;(.*?)&lt;/h1&gt;&#39;</span>
        <span class=n>video_title</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>title_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=k>print</span><span class=p>(</span><span class=n>f</span><span class=s1>&#39;正在下载视频：{video_title[0]}&#39;</span><span class=p>)</span>
        <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>video_url</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>storage</span><span class=p>,</span> <span class=n>f</span><span class=s2>&#34;{video_title[0]}.mp4&#34;</span><span class=p>))</span>


<span class=c1># 进阶，在科技页面找到所有作者进入作者页面，保存对应视频</span>
<span class=k>def</span> <span class=nf>download_authorvideo</span><span class=p>():</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
    <span class=n>author_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;column&#34;&gt;&#39;</span>
    <span class=n>author_ids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>author_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
    <span class=n>author_url</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>author_ids</span><span class=p>:</span>
        <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>_</span>
        <span class=k>if</span> <span class=n>_url</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>author_url</span><span class=p>:</span>
            <span class=n>author_url</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>

    <span class=n>videos</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>author_url</span><span class=p>:</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>vids_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;vervideo-lilink actplay&#34;&gt;&#39;</span>
        <span class=n>vids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>vids_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>vids</span><span class=p>:</span>
            <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>v</span>
            <span class=n>videos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>

    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>videos</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=n>_</span><span class=p>)</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>mp4_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;ldUrl=&#34;&#34;,srcUrl=&#34;(.*?)&#34;,vdoUrl=&#39;</span>
        <span class=n>video_url</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>mp4_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=n>title_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;h1 class=&#34;video-tt&#34;&gt;(.*?)&lt;/h1&gt;&#39;</span>
        <span class=n>video_title</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>title_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=k>print</span><span class=p>(</span><span class=n>f</span><span class=s1>&#39;正在下载视频：{video_title[0]}&#39;</span><span class=p>)</span>
        <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>video_url</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>storage</span><span class=p>,</span> <span class=n>f</span><span class=s2>&#34;{video_title[0]}.mp4&#34;</span><span class=p>))</span>

<span class=c1># 进阶，将视频名称保存为md5加密值，并将描述文字保存为相同md5值的txt文件</span>
<span class=k>def</span> <span class=nf>md5_video</span><span class=p>():</span>
    <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
    <span class=n>vids_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;a href=&#34;(.*?)&#34; class=&#34;vervideo-lilink actplay&#34;&gt;&#39;</span>
    <span class=n>vids</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>vids_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
    <span class=n>videos</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>vids</span><span class=p>:</span>
        <span class=n>_url</span> <span class=o>=</span> <span class=n>prefix_url</span> <span class=o>+</span> <span class=n>_</span>
        <span class=n>videos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>_url</span><span class=p>)</span>

    <span class=c1># 访问视频地址，将视频保存为md5加密后的视频文件</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>videos</span><span class=p>:</span>
        <span class=k>print</span><span class=p>(</span><span class=n>_</span><span class=p>)</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>_</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
        <span class=n>mp4_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;ldUrl=&#34;&#34;,srcUrl=&#34;(.*?)&#34;,vdoUrl=&#39;</span>
        <span class=n>video_url</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>mp4_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=n>title_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;h1 class=&#34;video-tt&#34;&gt;(.*?)&lt;/h1&gt;&#39;</span>
        <span class=n>video_title</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>title_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>

        <span class=n>md5</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>()</span>
        <span class=n>md5</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>video_title</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
        <span class=n>md5_title</span> <span class=o>=</span> <span class=n>md5</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>

        <span class=k>print</span><span class=p>(</span><span class=n>f</span><span class=s1>&#39;正在下载视频：{video_title[0]}&#39;</span><span class=p>)</span>
        <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlretrieve</span><span class=p>(</span><span class=n>video_url</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>storage</span><span class=p>,</span> <span class=n>f</span><span class=s2>&#34;{md5_title}.mp4&#34;</span><span class=p>))</span>

        <span class=n>sum_regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s1>&#39;&lt;div class=&#34;summary&#34;&gt;(.*?)&lt;/div&gt;&#39;</span>
        <span class=n>video_sum</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>sum_regex</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>f</span><span class=s2>&#34;videos/{md5_title}.txt&#34;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>video_sum</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=c1># download_pearvideo()</span>
    <span class=c1># download_authorvideo()</span>
    <span class=n>md5_video</span><span class=p>()</span>
</code></pre></div></div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href=/tags/spider/><i class="fas fa-tag mr-2"></i>spider
</a><a class="badge badge-pill badge-light border mr-2" href=/tags/requests/><i class="fas fa-tag mr-2"></i>requests
</a><a class="badge badge-pill badge-light border mr-2" href=/tags/%E7%88%AC%E8%99%AB/><i class="fas fa-tag mr-2"></i>爬虫</a></div><div style=text-align:center><div class=social-share data-sites=wechat,weibo,twitter,facebook,douban data-mobile-sites=wechat,weibo></div></div></div></div><div class="row justify-content-center"><div class=col-lg-8><div id=comments-gittalk></div><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>var gittalk=new Gitalk({id:'0x000012',owner:'Ryuchen',repo:'ryuchen.github.io',admin:['Ryuchen'],clientID:'cda75f43f62ef6ebc3ea',clientSecret:'e405fb603c664a6436a481917a7ee70931413268',})
gittalk.render('comments-gittalk')</script></div></div></article></div></div><div class="related-content row mt-5 row-cols-1 row-cols-lg-3"><div class="col mb-3"><div class="card h-100 shadow"><a href=/posts/0x000010/ class=d-block><img data-src=https://cdn.jsdelivr.net/gh/Ryuchen/ryuchen.github.io@master/images/spider-requests_huc4b4663bc63a0e31a40f04bc97652a90_494620_700x350_resize_q75_box.jpg class="card-img-top mx-auto d-block" alt=requests入门使用><div class=card-body><div class=card-title>requests入门使用</div><div class=card-serie><span class="badge badge-pill badge-primary">爬虫系列</span> &nbsp;</div><p class="card-text text-muted text-uppercase">March 24, 2020</p><div class=card-text>这是一个系列内容，最近女友在跟我学习Python编程，然后就开了这个爬虫系列，主要也是借此机会将自己所会的爬虫相关的知识进行梳理并同时做好备课工作~~【如果这个系列对你有帮助的话，请在这个博客下面留言，我会尽可能做好思路梳理】</div></div></a></div></div></div></main><footer class="footer bg-dark py-6"><div class=container><div class=row><div class="col-sm text-center"><ul class=list-inline><li class=list-inline-item><a href=https://ryuchen.club/index.xml rel=alternate type=application/rss+xml class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=mailto:chenhaom1993@hotmail.com class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://github.com/Ryuchen class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://weibo.com/u/3147247770 class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-weibo fa-stack-1x fa-inverse"></i></span></a></li></ul><p class=text-muted>Copyright © 2018–2020, WangOO and Ryuchen, all rights reserved.</p><p class=text-muted>京ICP备2020040667号</p><p class=text-muted>本站总记被访问 <span id=busuanzi_value_site_pv></span>次，
您是第 <span id=busuanzi_value_site_uv></span>个来访小伙伴。</p></div><div class="col-sm text-center"><p class=text-muted>维护不易，渴望您的资助</p><ul class=list-inline><div class=row><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/wechat.jpg alt=WechatPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/alipay.jpg alt=AliPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div></div></ul></div></div></div><div class=netease-music><audio id=music-player crossorigin playsinline></audio></div></footer><script src=/dist/main.bf9558b8596b4accd07a.min.js></script><script src=https://cdn.jsdelivr.net/gh/Ryuchen/ryuchen.github.io@master//mermaid/mermaid.js></script><script>window.Prism=window.Prism||{};</script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/prism.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script>(function(){var el=document.createElement("script");el.src="https://s3a.pstatp.com/toutiao/push.js?1b349c44e658214c68be3a649c8dd67d03df3ccff5cf4d26c95620535e04d891417631efa03c64873bef9496a5c9bb7c62f7c4af6b1a55b161baff8a0b4e2fba";el.id="ttzz";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(el,s);})(window)</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js integrity="sha256-fGPu+icKh985TLPhO2v68U7i0CW0dE4kiR06RN4O6jo=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0EFH27TG1R"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-0EFH27TG1R');</script></body></html>