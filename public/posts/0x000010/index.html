<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=yes"><title>requests入门使用 | Sweet House</title><meta name=description content="Everyday is a holiday"><meta name=bytedance-verification-code content="MmXZwSvr8lAvM1hIXSkm"><meta name=author content="[Ryuchen WangOO]"><link rel=icon href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism-dark.min.css><link rel=stylesheet href=/dist/main.4707e15c5ca4eab5da71.min.css><link rel=stylesheet href=/css/shortcodes.css><link rel=canonical href=https://ryuchen.club/posts/0x000010/><meta property="og:title" content="requests入门使用"><meta property="og:description" content="这是一个系列内容，最近女友在跟我学习Python编程，然后就开了这个爬虫系列，主要也是借此机会将自己所会的爬虫相关的知识进行梳理并同时做好备课工作~~【如果这个系列对你有帮助的话，请在这个博客下面留言，我会尽可能做好思路梳理】"><meta property="og:type" content="article"><meta property="og:url" content="https://ryuchen.club/posts/0x000010/"><meta property="og:image" content="https://ryuchen.club/spider-requests.jpg"><meta property="article:published_time" content="2020-03-24T00:00:00+00:00"><meta property="article:modified_time" content="2020-03-24T00:00:00+00:00"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000015/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000014/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000013/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000011/"><meta property="og:see_also" content="https://ryuchen.club/posts/0x000012/"><meta itemprop=name content="requests入门使用"><meta itemprop=description content="这是一个系列内容，最近女友在跟我学习Python编程，然后就开了这个爬虫系列，主要也是借此机会将自己所会的爬虫相关的知识进行梳理并同时做好备课工作~~【如果这个系列对你有帮助的话，请在这个博客下面留言，我会尽可能做好思路梳理】"><meta itemprop=datePublished content="2020-03-24T00:00:00+00:00"><meta itemprop=dateModified content="2020-03-24T00:00:00+00:00"><meta itemprop=wordCount content="404"><meta itemprop=image content="https://ryuchen.club/spider-requests.jpg"><meta itemprop=keywords content="spider,requests,爬虫,"></head><body><nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id=navbar-main-menu><div class=container><a class="navbar-brand font-weight-bold" href=https://ryuchen.club>>$ cd /home_</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#main-menu aria-controls=main-menu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=main-menu><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>首页</a></li><li class=nav-item><a class=nav-link href=/posts/>博文</a></li><li class=nav-item><a class=nav-link href=/projects/>项目</a></li><li class=nav-item><a class=nav-link href=/snippet/>代码</a></li><li class=nav-item><a class=nav-link href=/essay/>随笔</a></li><li class=nav-item><a class=nav-link href=/gallery/>照片墙</a></li><li class=nav-item><a class=nav-link href=/about/>关于</a></li><li class=nav-item><a class=nav-link href=https://github.com/Ryuchen target=_blank>Github</a></li></ul></div></div></nav><main class="content-page container pt-7 pb-5"><div class=row><div class=col><article><div class="row justify-content-center"><div class=col-lg-10><h1>requests入门使用</h1><div class="meta text-muted mb-3" style=text-align:right><p class="created text-muted text-uppercase font-weight-bold mb-1">March 24, 2020</p><span class=mr-2><i class="fas fa-book-open mr-2"></i>1844</span>
<span><i class="fas fa-clock mr-2"></i>8 minutes and
22 seconds</span></div><div class="category my-3"><a class="badge badge-pill badge-light border mr-2" href=/categories/%E7%88%AC%E8%99%AB%E7%B3%BB%E5%88%97><i class="fas fa-tag mr-2"></i>爬虫系列</a></div></div></div><div class="row justify-content-center mb-3"><div class=col-lg-10><img data-src=/images/spider-requests_huc4b4663bc63a0e31a40f04bc97652a90_494620_900x500_fit_q75_box.jpg class="img-fluid rounded mx-auto d-block" alt=requests入门使用></div></div><div class="row justify-content-center"><div class=col-lg-10><div class=content><blockquote><p>[DeadPool爬虫]requests入门使用</p></blockquote><p>在进行完Python的基础学习之后，如何提高Python的相关编程能力？个人觉得最快捷的手段还是从Python的项目实战开始，说道Python的项目实战，爬虫、Web开发和机器学习是当下应用最广泛的领域了，那么就正好借此机会整理一个爬虫的系列内容，一是通过授课和实战，解决代码编程量少的问题；二是锻炼自己在进行整体项目开发的时候代码组织能力；三是帮自己整理思路，把相关的爬虫知识进行查漏补缺。</p><h5 id=requests-包>requests 包</h5><p>在学习整体的爬虫框架之前，也是先从相关的基础技术开始介绍起。首当其冲的就是requests包的使用，无论什么样的请求都要从最开始的HTTP请求开始。requests是Python的第三方库，但是在处理网络资源访问时，堪称神器~</p><p>这里特别要引用官方文档开头的一段话，十分让人心情愉悦~</p><pre><code>Requests 唯一的一个非转基因的 Python HTTP 库，人类可以安全享用。

警告：非专业使用其他 HTTP 库会导致危险的副作用，包括：安全缺陷症、冗余代码症、重新发明轮子症、啃文档症、抑郁、头疼、甚至死亡。
</code></pre><p>那么 requests 的是否真的像它描述的这么神奇？可以参见官方给的对比例子~</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=err>这里是</span><span class=n>Python内置的urllib包进行访问</span>

<span class=c1>#!/usr/bin/env python</span>
<span class=c1># -*- coding: utf-8 -*-</span>

<span class=kn>import</span> <span class=nn>urllib2</span>

<span class=n>gh_url</span> <span class=o>=</span> <span class=s1>&#39;https://api.github.com&#39;</span>

<span class=n>req</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>gh_url</span><span class=p>)</span>

<span class=n>password_manager</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>HTTPPasswordMgrWithDefaultRealm</span><span class=p>()</span>
<span class=n>password_manager</span><span class=o>.</span><span class=n>add_password</span><span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=n>gh_url</span><span class=p>,</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;pass&#39;</span><span class=p>)</span>

<span class=n>auth_manager</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>HTTPBasicAuthHandler</span><span class=p>(</span><span class=n>password_manager</span><span class=p>)</span>
<span class=n>opener</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>build_opener</span><span class=p>(</span><span class=n>auth_manager</span><span class=p>)</span>

<span class=n>urllib2</span><span class=o>.</span><span class=n>install_opener</span><span class=p>(</span><span class=n>opener</span><span class=p>)</span>

<span class=n>handler</span> <span class=o>=</span> <span class=n>urllib2</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>req</span><span class=p>)</span>

<span class=k>print</span> <span class=n>handler</span><span class=o>.</span><span class=n>getcode</span><span class=p>()</span>
<span class=k>print</span> <span class=n>handler</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>getheader</span><span class=p>(</span><span class=s1>&#39;content-type&#39;</span><span class=p>)</span>

<span class=c1># ------</span>
<span class=c1># 200</span>
<span class=c1># &#39;application/json&#39;</span>

</code></pre></div><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=err>这里是</span><span class=n>requests包进行访问</span>

<span class=c1>#!/usr/bin/env python</span>
<span class=c1># -*- coding: utf-8 -*-</span>

<span class=kn>import</span> <span class=nn>requests</span>

<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://api.github.com&#39;</span><span class=p>,</span> <span class=n>auth</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=s1>&#39;pass&#39;</span><span class=p>))</span>

<span class=k>print</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span>
<span class=k>print</span> <span class=n>r</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;content-type&#39;</span><span class=p>]</span>

<span class=c1># ------</span>
<span class=c1># 200</span>
<span class=c1># &#39;application/json&#39;</span>

</code></pre></div><p>虽然针对Python3的现在是否requests还是最优的选择，暂不讨论，但是还是可以窥见在那个时候其杀伤力多么强大~</p><h5 id=requests-使用>requests 使用</h5><p>先声明一下，这个课程的内容先只是简单入门教程，还不涉及到高级用法~</p><blockquote><p>PS:个人意见，与其看我BB，不如直接把官方文档好好读一读~ <a href=https://requests.readthedocs.io/en/master/>requests官方文档</a></p></blockquote><h6 id=总结创建请求>总结创建请求</h6><p>虽然官方文档说了一小段如何进行requests创建请求，但是总结起来的时候可以发现结合现代风格的REST API更好记忆</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=c1># 进行HEAD请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>

<span class=c1># 进行OPTIONS请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>

<span class=c1># 进行GET请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/get&#39;</span><span class=p>)</span>

<span class=c1># 进行POST请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/post&#39;</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;value&#39;</span><span class=p>})</span>

<span class=c1># 进行PUT请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/put&#39;</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;value&#39;</span><span class=p>})</span>

<span class=c1># 进行DELETE请求</span>
<span class=n>requests</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/delete&#39;</span><span class=p>)</span>
</code></pre></div><h6 id=response类型>response类型</h6><p>使用requests进行请求之后返回的response主要有以下几个类型：</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=c1># Regular Response 常规类型</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>text</span>

<span class=c1># RETURN HTML BODY</span>

<span class=c1># Json Response Json类型</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>

<span class=c1># RETURN JSON BODY</span>

<span class=c1># Binary Response 二进制类型</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>content</span>

<span class=c1># RETURN BINARY BODY</span>


<span class=c1># 附加的原始内容</span>
<span class=c1># Raw Response 原始内容</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>raw</span>

<span class=c1># RETURN RAW BYTES</span>
<span class=c1># PS: 这里是二进制的bytes流，你得自己对字节流进行手动处理了~</span>
</code></pre></div><p>这里其实也就是常见的HTTP返回格式，有点前端开发基础的就很好记了~</p><h6 id=requestsresponse-header>requests&&response header</h6><p>自定义 requests header</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=c1># 定义header内容，按照要求自定义就行了</span>
<span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;user-agent&#39;</span><span class=p>:</span> <span class=s1>&#39;my-app/0.0.1&#39;</span><span class=p>}</span>

<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/get&#39;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</code></pre></div><p>查看 response header</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/get&#39;</span><span class=p>)</span>
<span class=n>r</span><span class=o>.</span><span class=n>headers</span>

<span class=c1># 查看全部返回的headers内容</span>
<span class=p>{</span>
    <span class=s1>&#39;content-encoding&#39;</span><span class=p>:</span> <span class=s1>&#39;gzip&#39;</span><span class=p>,</span>
    <span class=s1>&#39;transfer-encoding&#39;</span><span class=p>:</span> <span class=s1>&#39;chunked&#39;</span><span class=p>,</span>
    <span class=s1>&#39;connection&#39;</span><span class=p>:</span> <span class=s1>&#39;close&#39;</span><span class=p>,</span>
    <span class=s1>&#39;server&#39;</span><span class=p>:</span> <span class=s1>&#39;nginx/1.0.4&#39;</span><span class=p>,</span>
    <span class=s1>&#39;x-runtime&#39;</span><span class=p>:</span> <span class=s1>&#39;148ms&#39;</span><span class=p>,</span>
    <span class=s1>&#39;etag&#39;</span><span class=p>:</span> <span class=s1>&#39;&#34;e1ca502697e5c9317743dc078f67693f&#34;&#39;</span><span class=p>,</span>
    <span class=s1>&#39;content-type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span>
<span class=p>}</span>

<span class=c1># 获取指定字段</span>
<span class=n>r</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>]</span>
</code></pre></div><h6 id=requests-参数>requests 参数</h6><p>这里初级使用方式只介绍两种请求的时候带参数的方式：</p><p>GET请求带参数</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>payload</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;key1&#39;</span><span class=p>:</span> <span class=s1>&#39;value1&#39;</span><span class=p>,</span> <span class=s1>&#39;key2&#39;</span><span class=p>:</span> <span class=s1>&#39;value2&#39;</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://httpbin.org/get&#39;</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</code></pre></div><p>POST请求带参数</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=n>payload</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;key1&#39;</span><span class=p>:</span> <span class=s1>&#39;value1&#39;</span><span class=p>,</span> <span class=s1>&#39;key2&#39;</span><span class=p>:</span> <span class=s1>&#39;value2&#39;</span><span class=p>}</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;https://httpbin.org/post&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>payload</span><span class=p>)</span>
</code></pre></div><p>剩下的待参数的方式就是属于 requests 的高级用法了~</p><h6 id=requests-cookies>requests Cookies</h6><p>同requests的header一样，这里也是请求时带上cookies和返回时获取cookies</p><p>获取cookies</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://example.com/some/cookie/setting/url&#39;</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>

<span class=c1># 获取全部的cookies</span>
<span class=n>r</span><span class=o>.</span><span class=n>cookies</span>

<span class=c1># 获得指定cookies</span>
<span class=n>r</span><span class=o>.</span><span class=n>cookies</span><span class=p>[</span><span class=s1>&#39;example_cookie_name&#39;</span><span class=p>]</span>

</code></pre></div><p>请求时带上cookies</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;https://httpbin.org/cookies&#39;</span>
<span class=n>cookies</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>cookies_are</span><span class=o>=</span><span class=s1>&#39;working&#39;</span><span class=p>)</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>)</span>

</code></pre></div><p>这里官网做了说明返回的cookies其实是一个对象RequestsCookieJar而非常规的字符串，所以可以设置复杂的cookies进行操作</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=n>jar</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>RequestsCookieJar</span><span class=p>()</span>
<span class=n>jar</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s1>&#39;tasty_cookie&#39;</span><span class=p>,</span> <span class=s1>&#39;yum&#39;</span><span class=p>,</span> <span class=n>domain</span><span class=o>=</span><span class=s1>&#39;httpbin.org&#39;</span><span class=p>,</span> <span class=n>path</span><span class=o>=</span><span class=s1>&#39;/cookies&#39;</span><span class=p>)</span>
<span class=n>jar</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s1>&#39;gross_cookie&#39;</span><span class=p>,</span> <span class=s1>&#39;blech&#39;</span><span class=p>,</span> <span class=n>domain</span><span class=o>=</span><span class=s1>&#39;httpbin.org&#39;</span><span class=p>,</span> <span class=n>path</span><span class=o>=</span><span class=s1>&#39;/elsewhere&#39;</span><span class=p>)</span>
<span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;https://httpbin.org/cookies&#39;</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>jar</span><span class=p>)</span>

</code></pre></div><h6 id=requests-timeout>requests Timeout</h6><p>首先要声明一点requests的超时并不是想象中的请求整个动作的过程的超时，而是在对请求发出之后服务器应答这个过程进行事件判断，更精确的说，是在设置的timeout秒内没有从基础套接字上接受到任何字节的数据时，如果结合socket编程的话，就会更明显的有感受，但是这个不属于Python的基础开发了。</p><p>但是也建议在规模化请求资源的时候，加上这个参数，防止程序失去响应</p><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;http://github.com&#39;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mf>0.001</span><span class=p>)</span>

<span class=n>Traceback</span> <span class=p>(</span><span class=n>most</span> <span class=n>recent</span> <span class=n>call</span> <span class=n>last</span><span class=p>):</span>
  <span class=n>File</span> <span class=s2>&#34;&lt;stdin&gt;&#34;</span><span class=p>,</span> <span class=n>line</span> <span class=mi>1</span><span class=p>,</span> <span class=ow>in</span> <span class=o>&lt;</span><span class=n>module</span><span class=o>&gt;</span>
<span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>Timeout</span><span class=p>:</span> <span class=n>HTTPConnectionPool</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;github.com&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>80</span><span class=p>):</span> <span class=n>Request</span> <span class=n>timed</span> <span class=n>out</span><span class=o>.</span> <span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.001</span><span class=p>)</span>

</code></pre></div><h5 id=实战练习>实战练习</h5><p>其实requests的使用并不是很难，结合一个实战的例子就很好掌握了，下面就是结合上面所说的实战练习</p><p>目标是：
通过请求B站的舞曲链接地址，获得页面内容，然后从中匹配到舞蹈视频的链接，然后在请求每个舞蹈视频的地址，输出页面内容</p><blockquote><p>代码链接来自我<a href=https://github.com/huandoit/pyStudy/blob/master/daily/2020-03-24.py>女朋友的Github-2020-03-24</a></p></blockquote><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=c1>#!/usr/bin/env python</span>
<span class=c1># -*- coding: utf-8 -*-</span>
<span class=s2>&#34;&#34;&#34;
</span><span class=s2>@Time    : 2020/3/25 16:47
</span><span class=s2>@Author  : WangHuan
</span><span class=s2>@Contact : hi_chengzi@126.com
</span><span class=s2>@File    : 2020-03-24.py
</span><span class=s2>@Software: PyCharm
</span><span class=s2>@description: 
</span><span class=s2>&#34;&#34;&#34;</span>


<span class=kn>import</span> <span class=nn>re</span>
<span class=kn>import</span> <span class=nn>requests</span>


<span class=n>seed_url</span> <span class=o>=</span> <span class=s2>&#34;https://www.bilibili.com/v/dance&#34;</span>

<span class=n>regex</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;\&lt;a href=</span><span class=se>\&#34;</span><span class=s2>\/\/www\.bilibili\.com\/video\/[a-zA-Z0-9]+</span><span class=se>\&#34;</span><span class=s2>&#34;</span>


<span class=k>def</span> <span class=nf>fetch_seed_context</span><span class=p>():</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>seed_url</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>index_obj</span><span class=p>:</span>
        <span class=n>index_obj</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>


<span class=k>def</span> <span class=nf>extract_herf</span><span class=p>():</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>index_obj</span><span class=p>:</span>
        <span class=n>content</span> <span class=o>=</span> <span class=n>index_obj</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
        <span class=n>matches</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>finditer</span><span class=p>(</span><span class=n>regex</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=n>re</span><span class=o>.</span><span class=n>MULTILINE</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>matchNum</span><span class=p>,</span> <span class=n>match</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>matches</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
            <span class=n>target_url</span> <span class=o>=</span> <span class=s2>&#34;https:{0}&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>match</span><span class=o>.</span><span class=n>group</span><span class=p>()[</span><span class=mi>9</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
            <span class=k>print</span><span class=p>(</span><span class=n>target_url</span><span class=p>)</span>

            <span class=n>next_r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>target_url</span><span class=p>)</span>
            <span class=k>print</span><span class=p>(</span><span class=n>next_r</span><span class=p>)</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=n>fetch_seed_context</span><span class=p>()</span>
    <span class=n>extract_herf</span><span class=p>()</span>

</code></pre></div></div><div class="tags my-3"><a class="badge badge-pill badge-light border mr-2" href=/tags/spider/><i class="fas fa-tag mr-2"></i>spider
</a><a class="badge badge-pill badge-light border mr-2" href=/tags/requests/><i class="fas fa-tag mr-2"></i>requests
</a><a class="badge badge-pill badge-light border mr-2" href=/tags/%E7%88%AC%E8%99%AB/><i class="fas fa-tag mr-2"></i>爬虫</a></div><div style=text-align:center><div class=social-share data-sites=wechat,weibo,twitter,facebook,douban data-mobile-sites=wechat,weibo></div></div></div></div><div class="row justify-content-center"><div class=col-lg-8><div id=comments-gittalk></div><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>var gittalk=new Gitalk({id:'0x000010',owner:'Ryuchen',repo:'ryuchen.github.io',admin:['Ryuchen'],clientID:'cda75f43f62ef6ebc3ea',clientSecret:'e405fb603c664a6436a481917a7ee70931413268',})
gittalk.render('comments-gittalk')</script></div></div></article></div></div></main><footer class="footer bg-dark py-6"><div class=container><div class=row><div class="col-sm text-center"><ul class=list-inline><li class=list-inline-item><a href=https://ryuchen.club/index.xml rel=alternate type=application/rss+xml class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=mailto:chenhaom1993@hotmail.com class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://github.com/Ryuchen class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://weibo.com/u/3147247770 class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-weibo fa-stack-1x fa-inverse"></i></span></a></li></ul><p class=text-muted>Copyright © 2018–2020, WangOO and Ryuchen, all rights reserved.</p><p class=text-muted>京ICP备2020040667号</p><p class=text-muted>本站总记被访问 <span id=busuanzi_value_site_pv></span>次，
您是第 <span id=busuanzi_value_site_uv></span>个来访小伙伴。</p></div><div class="col-sm text-center"><p class=text-muted>维护不易，渴望您的资助</p><ul class=list-inline><div class=row><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/wechat.jpg alt=WechatPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/alipay.jpg alt=AliPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div></div></ul></div></div></div><div class=netease-music><audio id=music-player crossorigin playsinline></audio></div></footer><script src=/dist/main.bf9558b8596b4accd07a.min.js></script><script src=https://cdn.jsdelivr.net/gh/Ryuchen/ryuchen.github.io@master//mermaid/mermaid.js></script><script>window.Prism=window.Prism||{};</script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/prism.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script>(function(){var el=document.createElement("script");el.src="https://s3a.pstatp.com/toutiao/push.js?1b349c44e658214c68be3a649c8dd67d03df3ccff5cf4d26c95620535e04d891417631efa03c64873bef9496a5c9bb7c62f7c4af6b1a55b161baff8a0b4e2fba";el.id="ttzz";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(el,s);})(window)</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js integrity="sha256-fGPu+icKh985TLPhO2v68U7i0CW0dE4kiR06RN4O6jo=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0EFH27TG1R"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-0EFH27TG1R');</script></body></html>