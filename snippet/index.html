<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=yes"><title>Code Snippet | Sweet House</title><meta name=description content="Everyday is a holiday"><meta name=bytedance-verification-code content="MmXZwSvr8lAvM1hIXSkm"><meta name=author content="[Ryuchen WangOO]"><link rel=icon href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/themes/prism-dark.min.css><link rel=stylesheet href=/dist/main.4707e15c5ca4eab5da71.min.css><link rel=stylesheet href=/css/shortcodes.css><link href=https://ryuchen.club/snippet/index.xml rel=alternate type=application/rss+xml title="Sweet House"><link href=https://ryuchen.club/snippet/index.xml rel=feed type=application/rss+xml title="Sweet House"><link rel=canonical href=https://ryuchen.club/snippet/><meta property="og:title" content="Code Snippet"><meta property="og:description" content="Everyday is a holiday"><meta property="og:type" content="website"><meta property="og:url" content="https://ryuchen.club/snippet/"><meta itemprop=name content="Code Snippet"><meta itemprop=description content="Everyday is a holiday"></head><body><nav class="navbar navbar-expand-md navbar-light bg-light fixed-top shadow-sm" id=navbar-main-menu><div class=container><a class="navbar-brand font-weight-bold" href=https://ryuchen.club>>$ cd /home_</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#main-menu aria-controls=main-menu aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=main-menu><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/>首页</a></li><li class=nav-item><a class=nav-link href=/posts/>博文</a></li><li class=nav-item><a class=nav-link href=/projects/>项目</a></li><li class="nav-item active"><a class=nav-link href=/snippet/>代码</a></li><li class=nav-item><a class=nav-link href=/essay/>随笔</a></li><li class=nav-item><a class=nav-link href=/gallery/>照片墙</a></li><li class=nav-item><a class=nav-link href=/about/>关于</a></li><li class=nav-item><a class=nav-link href=https://github.com/Ryuchen target=_blank>Github</a></li></ul></div></div></nav><main class="list container py-6"><div class="row py-3"><div class=col><h3 class=display-4>Code Snippet</h3><div class=content><p>平时在写代码的过程中经常会使用的代码片段记录在这个地方，方便自己的查找~</p></div></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-实现celery动态加载task>Python 实现celery动态加载task</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=c1># When celery after initialise we register our task into the celery.</span>
<span class=nd>@app.on_after_configure.connect</span>
<span class=k>def</span> <span class=nf>setup_celery_tasks</span><span class=p>(</span><span class=n>sender</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
    <span class=k>for</span> <span class=n>task_name</span><span class=p>,</span> <span class=n>task_option</span> <span class=ow>in</span> <span class=n>Settings</span><span class=o>.</span><span class=n>jobs_config</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;jobs&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=n>module_path</span> <span class=o>=</span> <span class=s1>&#39;apps.{0}.tasks.{1}&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>task_option</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;module&#34;</span><span class=p>),</span> <span class=n>task_name</span><span class=p>)</span>
        <span class=k>try</span><span class=p>:</span>
            <span class=n>ip_module</span> <span class=o>=</span> <span class=n>importlib</span><span class=o>.</span><span class=n>import_module</span><span class=p>(</span><span class=n>module_path</span><span class=p>)</span>
            <span class=n>ip_module_class</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>ip_module</span><span class=p>,</span> <span class=n>task_option</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;class&#34;</span><span class=p>))</span>
            <span class=n>ip_module_class</span><span class=o>.</span><span class=n>options</span> <span class=o>=</span> <span class=n>task_option</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;options&#34;</span><span class=p>)</span>
            <span class=n>ip_module_class</span><span class=o>.</span><span class=n>register</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
            <span class=n>task_instance</span> <span class=o>=</span> <span class=n>ip_module_class</span><span class=p>()</span>
            <span class=n>sender</span><span class=o>.</span><span class=n>register_task</span><span class=p>(</span><span class=n>task_instance</span><span class=p>)</span>
            <span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;successes load job task on deadpool app at on_after_configure.connect&#34;</span><span class=p>)</span>
        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
            <span class=n>log</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>

</code></pre></div></div></div></article></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-实现yaml文件动态加载>Python 实现Yaml文件动态加载</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>yaml</span>

<span class=k>class</span> <span class=nc>Loader</span><span class=p>(</span><span class=n>yaml</span><span class=o>.</span><span class=n>SafeLoader</span><span class=p>):</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>stream</span><span class=p>):</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_root</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>stream</span><span class=o>.</span><span class=n>name</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

        <span class=nb>super</span><span class=p>(</span><span class=n>Loader</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>stream</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>include</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>node</span><span class=p>):</span>

        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_root</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>construct_scalar</span><span class=p>(</span><span class=n>node</span><span class=p>))</span>

        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>yaml</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>Loader</span><span class=p>)</span>

<span class=n>Loader</span><span class=o>.</span><span class=n>add_constructor</span><span class=p>(</span><span class=s1>&#39;!include&#39;</span><span class=p>,</span> <span class=n>Loader</span><span class=o>.</span><span class=n>include</span><span class=p>)</span>

</code></pre></div></div></div></article></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-实现两个配置文件合并>Python 实现两个配置文件合并</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>Settings</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    This function to protect the custom setting config does not influence the program successfully start up.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=c1># The default program settings</span>
    <span class=n>default_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>SANDBOX_CONFIG_DIR</span><span class=p>,</span> <span class=s2>&#34;default.yaml&#34;</span><span class=p>)</span>

    <span class=c1># The finally running settings</span>
    <span class=n>version</span> <span class=o>=</span> <span class=n>String</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>&#34;v1.0.0-alpha&#34;</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=bp>False</span><span class=p>)</span>
    <span class=n>variable</span> <span class=o>=</span> <span class=n>Variable</span><span class=p>()</span>
    <span class=n>advanced</span> <span class=o>=</span> <span class=n>Advanced</span><span class=p>()</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span> <span class=nf>loading_settings</span><span class=p>(</span><span class=bp>cls</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;
</span><span class=s2>        To merge the settings of default.yaml &amp; the settings of custom.yaml into the running setting.
</span><span class=s2>        :return:
</span><span class=s2>        &#34;&#34;&#34;</span>
        <span class=k>def</span> <span class=nf>merge_dict</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>source</span><span class=p>):</span>
            <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>source</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
                    <span class=n>merge_dict</span><span class=p>(</span><span class=n>target</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=n>key</span><span class=p>],</span> <span class=n>value</span><span class=p>)</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=nb>setattr</span><span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>default_path</span><span class=p>):</span>
            <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>default_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>default_config</span><span class=p>:</span>
                <span class=bp>cls</span><span class=o>.</span><span class=n>default_setting</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>default_config</span><span class=p>,</span> <span class=n>Loader</span><span class=o>=</span><span class=n>yaml</span><span class=o>.</span><span class=n>SafeLoader</span><span class=p>)</span>
                <span class=k>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=n>default_setting</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>

        <span class=c1># # TODO: where to place the custom.yaml file</span>
        <span class=c1># if os.path.exists(cls.default_path):</span>
        <span class=c1>#     with open(cls.default_path) as default_config:</span>
        <span class=c1>#         cls.settings = yaml.load(default_config, Loader=yaml.SafeLoader)</span>

        <span class=k>if</span> <span class=bp>cls</span><span class=o>.</span><span class=n>default_setting</span><span class=p>:</span>
            <span class=n>merge_dict</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=bp>cls</span><span class=o>.</span><span class=n>default_setting</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>cls</span>
</code></pre></div></div></div></article></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-实现三个自带验证的数据类型>Python 实现三个自带验证的数据类型</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=k>class</span> <span class=nc>Int</span><span class=p>(</span><span class=n>Type</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34; Integer Type Definition class &#34;&#34;&#34;</span>

    <span class=vm>__doc__</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Initialise its with params below:
</span><span class=s2>        :param default::默认值
</span><span class=s2>        :param allow_empty::可取空
</span><span class=s2>        :param v_range::范围 eg: (1, 10)
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>default</span><span class=p>,</span> <span class=n>allow_empty</span><span class=p>,</span> <span class=n>v_range</span><span class=o>=</span><span class=bp>None</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>v_range</span><span class=p>:</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>min_value</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_value</span><span class=p>)</span> <span class=o>=</span> <span class=n>v_range</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_value</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_value</span><span class=p>:</span>
                <span class=k>raise</span> <span class=n>PandaStartupError</span><span class=p>(</span><span class=s2>&#34;value range incorrect&#34;</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>min_value</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_value</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=bp>None</span><span class=p>)</span>
        <span class=nb>super</span><span class=p>(</span><span class=n>Int</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>default</span><span class=p>,</span> <span class=n>allow_empty</span><span class=p>)</span>

    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>def</span> <span class=nf>num_range</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>val</span><span class=p>):</span>
            <span class=n>_fin</span> <span class=o>=</span> <span class=n>val</span>
            <span class=k>if</span> <span class=n>ctx</span><span class=o>.</span><span class=n>min_value</span> <span class=ow>and</span> <span class=n>val</span> <span class=o>&lt;</span> <span class=n>ctx</span><span class=o>.</span><span class=n>min_value</span><span class=p>:</span>
                <span class=n>_fin</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>min_value</span>

            <span class=k>if</span> <span class=n>ctx</span><span class=o>.</span><span class=n>max_value</span> <span class=ow>and</span> <span class=n>ctx</span><span class=o>.</span><span class=n>max_value</span> <span class=o>&lt;</span> <span class=n>val</span><span class=p>:</span>
                <span class=n>_fin</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>max_value</span>
            <span class=k>return</span> <span class=n>_fin</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>Number</span><span class=p>):</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
                <span class=k>return</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>value</span> <span class=k>else</span> <span class=mi>0</span>

            <span class=k>return</span> <span class=n>num_range</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span> <span class=ow>and</span> <span class=n>value</span><span class=o>.</span><span class=n>isdigit</span><span class=p>():</span>
            <span class=n>_value</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>num_range</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>_value</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>default</span>

    <span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>Number</span><span class=p>):</span>
            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
                <span class=k>return</span> <span class=bp>False</span>

            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_value</span> <span class=ow>and</span> <span class=n>value</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>min_value</span><span class=p>:</span>
                <span class=k>return</span> <span class=bp>False</span>

            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_value</span> <span class=ow>and</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_value</span> <span class=o>&lt;</span> <span class=n>value</span><span class=p>:</span>
                <span class=k>return</span> <span class=bp>False</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>return</span> <span class=bp>False</span>

        <span class=k>return</span> <span class=bp>True</span>


<span class=k>class</span> <span class=nc>String</span><span class=p>(</span><span class=n>Type</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34; String Type Definition class &#34;&#34;&#34;</span>

    <span class=vm>__doc__</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Initialise its with params below:
</span><span class=s2>        :param default::默认值
</span><span class=s2>        :param allow_empty::可取空
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>if</span> <span class=n>value</span> <span class=k>else</span> <span class=bp>self</span><span class=o>.</span><span class=n>default</span>

    <span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>)</span>


<span class=k>class</span> <span class=nc>Boolean</span><span class=p>(</span><span class=n>Type</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34; Boolean Type Definition class &#34;&#34;&#34;</span>

    <span class=vm>__doc__</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Initialise its with params below:
</span><span class=s2>        :param default::默认值
</span><span class=s2>        :param allow_empty::可取空
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>if</span> <span class=n>value</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;true&#34;</span><span class=p>,</span> <span class=s2>&#34;True&#34;</span><span class=p>,</span> <span class=s2>&#34;yes&#34;</span><span class=p>,</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;on&#34;</span><span class=p>,</span> <span class=s2>&#34;open&#34;</span><span class=p>):</span>
            <span class=k>return</span> <span class=bp>True</span>
        <span class=k>if</span> <span class=n>value</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;false&#34;</span><span class=p>,</span> <span class=s2>&#34;False&#34;</span><span class=p>,</span> <span class=s2>&#34;no&#34;</span><span class=p>,</span> <span class=s2>&#34;0&#34;</span><span class=p>,</span> <span class=s2>&#34;off&#34;</span><span class=p>,</span> <span class=s2>&#34;close&#34;</span><span class=p>):</span>
            <span class=k>return</span> <span class=bp>False</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>default</span>

    <span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>return</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>bool</span><span class=p>)</span>
</code></pre></div></div></div></article></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-abc元类编程>Python ABC元类编程</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=kn>import</span> <span class=nn>abc</span>


<span class=k>class</span> <span class=nc>Type</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>abc</span><span class=o>.</span><span class=n>ABCMeta</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34; Base Class for Panda-Sandbox Type Definitions &#34;&#34;&#34;</span>

    <span class=vm>__doc__</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span><span class=s2>    Must Implement this class for subtype to create new instance.
</span><span class=s2>    Initialise its with params:
</span><span class=s2>    :param default::默认值
</span><span class=s2>    :param allow_empty::可取空
</span><span class=s2>    @Must implement with below methods:
</span><span class=s2>    :method parse::转化
</span><span class=s2>    :method check::校验
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>allow_empty</span><span class=o>=</span><span class=bp>False</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>default</span> <span class=o>=</span> <span class=n>default</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>allow_empty</span> <span class=o>=</span> <span class=n>allow_empty</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>_value</span> <span class=o>=</span> <span class=bp>None</span>

    <span class=k>def</span> <span class=fm>__set__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>instance</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>check</span><span class=p>(</span><span class=n>value</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_value</span> <span class=o>=</span> <span class=n>value</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>

    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_value</span><span class=p>:</span>
            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>default</span><span class=p>)</span>
        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_value</span><span class=p>)</span>

    <span class=nd>@abc.abstractmethod</span>
    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34; parse a raw input value to correct type value and locate in the value range &#34;&#34;&#34;</span>

    <span class=nd>@abc.abstractmethod</span>
    <span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34; check the type of a raw value whether we need this type in this instance &#34;&#34;&#34;</span>
</code></pre></div></div></div></article></div></div><div class="row row-cols-1 row-cols-lg-3"></div><div><article><div class="row justify-content-center snippet-code"><div class=snippet-code-list><h5 id=python-列举目录下指定名称文件>Python 列举目录下指定名称文件</h5><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>glob</span>

<span class=n>_current_dir</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>))</span>
<span class=n>DATA_ROOT</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>normpath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>_current_dir</span><span class=p>,</span> <span class=s2>&#34;..&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>))</span>


<span class=k>if</span> <span class=vm>__name__</span> <span class=o>=</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
    <span class=n>data_sets</span> <span class=o>=</span> <span class=n>glob</span><span class=o>.</span><span class=n>glob</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>DATA_ROOT</span><span class=p>,</span> <span class=s1>&#39;part_*.csv&#39;</span><span class=p>))</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data_sets</span><span class=p>:</span>
            <span class=k>print</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>

</code></pre></div></div></div></article></div></div><nav class=pagination style=display:flow-root><div style=float:left></div><div style=float:right><a class="btn btn-outline-primary" style=border-radius:2rem;text-decoration:none href=/snippet/page/2/><span class=next-text>下一页</span></a></div></nav><div id=comments-gittalk></div><link rel=stylesheet href=https://unpkg.com/gitalk/dist/gitalk.css><script src=https://unpkg.com/gitalk/dist/gitalk.min.js></script><script>var gittalk=new Gitalk({id:'_index',owner:'Ryuchen',repo:'ryuchen.github.io',admin:['Ryuchen'],clientID:'cda75f43f62ef6ebc3ea',clientSecret:'e405fb603c664a6436a481917a7ee70931413268',})
gittalk.render('comments-gittalk')</script></main><footer class="footer bg-dark py-6"><div class=container><div class=row><div class="col-sm text-center"><ul class=list-inline><li class=list-inline-item><a href=https://ryuchen.club/index.xml rel=alternate type=application/rss+xml class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-rss fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=mailto:chenhaom1993@hotmail.com class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://github.com/Ryuchen class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li class=list-inline-item><a href=https://weibo.com/u/3147247770 class="icons d-block"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fab fa-weibo fa-stack-1x fa-inverse"></i></span></a></li></ul><p class=text-muted>Copyright © 2018–2020, WangOO and Ryuchen, all rights reserved.</p><p class=text-muted>京ICP备2020040667号</p><p class=text-muted>本站总记被访问 <span id=busuanzi_value_site_pv></span>次，
您是第 <span id=busuanzi_value_site_uv></span>个来访小伙伴。</p></div><div class="col-sm text-center"><p class=text-muted>维护不易，渴望您的资助</p><ul class=list-inline><div class=row><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/wechat.jpg alt=WechatPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div><div class="col-sm text-center"><li class=list-inline-item><img src=https://cdn.jsdelivr.net/gh/Ryuchen/ImageBed@sponsor/alipay.jpg alt=AliPay class=loaded data-was-processed=true style=width:140px;padding:4px></li></div></div></ul></div></div></div><div class=netease-music><audio id=music-player crossorigin playsinline></audio></div></footer><script src=/dist/main.bf9558b8596b4accd07a.min.js></script><script src=https://cdn.jsdelivr.net/gh/Ryuchen/ryuchen.github.io@master//mermaid/mermaid.js></script><script>window.Prism=window.Prism||{};</script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/prism.min.js></script><script src=https://cdn.jsdelivr.net/npm/prismjs@1.22.0/plugins/autoloader/prism-autoloader.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}
else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script>(function(){var el=document.createElement("script");el.src="https://s3a.pstatp.com/toutiao/push.js?1b349c44e658214c68be3a649c8dd67d03df3ccff5cf4d26c95620535e04d891417631efa03c64873bef9496a5c9bb7c62f7c4af6b1a55b161baff8a0b4e2fba";el.id="ttzz";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(el,s);})(window)</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js integrity="sha256-fGPu+icKh985TLPhO2v68U7i0CW0dE4kiR06RN4O6jo=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0EFH27TG1R"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-0EFH27TG1R');</script></body></html>